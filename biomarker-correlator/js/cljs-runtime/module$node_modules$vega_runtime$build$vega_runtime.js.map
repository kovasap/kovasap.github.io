{
"version":3,
"file":"module$node_modules$vega_runtime$build$vega_runtime.js",
"lineCount":23,
"mappings":"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",
"sources":["node_modules/vega-runtime/build/vega-runtime.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$vega_runtime$build$vega_runtime\"] = function(global,require,module,exports) {\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('vega-util'), require('vega-dataflow')) :\n  typeof define === 'function' && define.amd ? define(['exports', 'vega-util', 'vega-dataflow'], factory) :\n  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global.vega = {}, global.vega, global.vega));\n}(this, (function (exports, vegaUtil, vegaDataflow) { 'use strict';\n\n  /**\n   * Parse a serialized dataflow specification.\n   */\n  function parse (spec) {\n    const ctx = this,\n          operators = spec.operators || []; // parse background\n\n    if (spec.background) {\n      ctx.background = spec.background;\n    } // parse event configuration\n\n\n    if (spec.eventConfig) {\n      ctx.eventConfig = spec.eventConfig;\n    } // parse locale configuration\n\n\n    if (spec.locale) {\n      ctx.locale = spec.locale;\n    } // parse operators\n\n\n    operators.forEach(entry => ctx.parseOperator(entry)); // parse operator parameters\n\n    operators.forEach(entry => ctx.parseOperatorParameters(entry)); // parse streams\n\n    (spec.streams || []).forEach(entry => ctx.parseStream(entry)); // parse updates\n\n    (spec.updates || []).forEach(entry => ctx.parseUpdate(entry));\n    return ctx.resolve();\n  }\n\n  const Skip = vegaUtil.toSet(['rule']),\n        Swap = vegaUtil.toSet(['group', 'image', 'rect']);\n  function adjustSpatial(encode, marktype) {\n    let code = '';\n    if (Skip[marktype]) return code;\n\n    if (encode.x2) {\n      if (encode.x) {\n        if (Swap[marktype]) {\n          code += 'if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;';\n        }\n\n        code += 'o.width=o.x2-o.x;';\n      } else {\n        code += 'o.x=o.x2-(o.width||0);';\n      }\n    }\n\n    if (encode.xc) {\n      code += 'o.x=o.xc-(o.width||0)/2;';\n    }\n\n    if (encode.y2) {\n      if (encode.y) {\n        if (Swap[marktype]) {\n          code += 'if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;';\n        }\n\n        code += 'o.height=o.y2-o.y;';\n      } else {\n        code += 'o.y=o.y2-(o.height||0);';\n      }\n    }\n\n    if (encode.yc) {\n      code += 'o.y=o.yc-(o.height||0)/2;';\n    }\n\n    return code;\n  }\n  function canonicalType(type) {\n    return (type + '').toLowerCase();\n  }\n  function isOperator(type) {\n    return canonicalType(type) === 'operator';\n  }\n  function isCollect(type) {\n    return canonicalType(type) === 'collect';\n  }\n\n  function expression(ctx, args, code) {\n    // wrap code in return statement if expression does not terminate\n    if (code[code.length - 1] !== ';') {\n      code = 'return(' + code + ');';\n    }\n\n    const fn = Function(...args.concat(code));\n    return ctx && ctx.functions ? fn.bind(ctx.functions) : fn;\n  } // generate code for comparing a single field\n\n\n  function _compare(u, v, lt, gt) {\n    return `((u = ${u}) < (v = ${v}) || u == null) && v != null ? ${lt}\n  : (u > v || v == null) && u != null ? ${gt}\n  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ${lt}\n  : v !== v && u === u ? ${gt} : `;\n  }\n\n  var expressionCodegen = {\n    /**\n     * Parse an expression used to update an operator value.\n     */\n    operator: (ctx, expr) => expression(ctx, ['_'], expr.code),\n\n    /**\n     * Parse an expression provided as an operator parameter value.\n     */\n    parameter: (ctx, expr) => expression(ctx, ['datum', '_'], expr.code),\n\n    /**\n     * Parse an expression applied to an event stream.\n     */\n    event: (ctx, expr) => expression(ctx, ['event'], expr.code),\n\n    /**\n     * Parse an expression used to handle an event-driven operator update.\n     */\n    handler: (ctx, expr) => {\n      const code = `var datum=event.item&&event.item.datum;return ${expr.code};`;\n      return expression(ctx, ['_', 'event'], code);\n    },\n\n    /**\n     * Parse an expression that performs visual encoding.\n     */\n    encode: (ctx, encode) => {\n      const {\n        marktype,\n        channels\n      } = encode;\n      let code = 'var o=item,datum=o.datum,m=0,$;';\n\n      for (const name in channels) {\n        const o = 'o[' + vegaUtil.stringValue(name) + ']';\n        code += `$=${channels[name].code};if(${o}!==$)${o}=$,m=1;`;\n      }\n\n      code += adjustSpatial(channels, marktype);\n      code += 'return m;';\n      return expression(ctx, ['item', '_'], code);\n    },\n\n    /**\n     * Optimized code generators for access and comparison.\n     */\n    codegen: {\n      get(path) {\n        const ref = `[${path.map(vegaUtil.stringValue).join('][')}]`;\n        const get = Function('_', `return _${ref};`);\n        get.path = ref;\n        return get;\n      },\n\n      comparator(fields, orders) {\n        let t;\n\n        const map = (f, i) => {\n          const o = orders[i];\n          let u, v;\n\n          if (f.path) {\n            u = `a${f.path}`;\n            v = `b${f.path}`;\n          } else {\n            (t = t || {})['f' + i] = f;\n            u = `this.f${i}(a)`;\n            v = `this.f${i}(b)`;\n          }\n\n          return _compare(u, v, -o, o);\n        };\n\n        const fn = Function('a', 'b', 'var u, v; return ' + fields.map(map).join('') + '0;');\n        return t ? fn.bind(t) : fn;\n      }\n\n    }\n  };\n\n  /**\n   * Parse a dataflow operator.\n   */\n\n  function parseOperator(spec) {\n    const ctx = this;\n\n    if (isOperator(spec.type) || !spec.type) {\n      ctx.operator(spec, spec.update ? ctx.operatorExpression(spec.update) : null);\n    } else {\n      ctx.transform(spec, spec.type);\n    }\n  }\n  /**\n   * Parse and assign operator parameters.\n   */\n\n  function parseOperatorParameters(spec) {\n    const ctx = this;\n\n    if (spec.params) {\n      const op = ctx.get(spec.id);\n      if (!op) vegaUtil.error('Invalid operator id: ' + spec.id);\n      ctx.dataflow.connect(op, op.parameters(ctx.parseParameters(spec.params), spec.react, spec.initonly));\n    }\n  }\n\n  /**\n   * Parse a set of operator parameters.\n   */\n\n  function parseParameters(spec, params) {\n    params = params || {};\n    const ctx = this;\n\n    for (const key in spec) {\n      const value = spec[key];\n      params[key] = vegaUtil.isArray(value) ? value.map(v => parseParameter(v, ctx, params)) : parseParameter(value, ctx, params);\n    }\n\n    return params;\n  }\n  /**\n   * Parse a single parameter.\n   */\n\n  function parseParameter(spec, ctx, params) {\n    if (!spec || !vegaUtil.isObject(spec)) return spec;\n\n    for (let i = 0, n = PARSERS.length, p; i < n; ++i) {\n      p = PARSERS[i];\n\n      if (vegaUtil.hasOwnProperty(spec, p.key)) {\n        return p.parse(spec, ctx, params);\n      }\n    }\n\n    return spec;\n  }\n  /** Reference parsers. */\n\n\n  var PARSERS = [{\n    key: '$ref',\n    parse: getOperator\n  }, {\n    key: '$key',\n    parse: getKey\n  }, {\n    key: '$expr',\n    parse: getExpression\n  }, {\n    key: '$field',\n    parse: getField\n  }, {\n    key: '$encode',\n    parse: getEncode\n  }, {\n    key: '$compare',\n    parse: getCompare\n  }, {\n    key: '$context',\n    parse: getContext\n  }, {\n    key: '$subflow',\n    parse: getSubflow\n  }, {\n    key: '$tupleid',\n    parse: getTupleId\n  }];\n  /**\n   * Resolve an operator reference.\n   */\n\n  function getOperator(_, ctx) {\n    return ctx.get(_.$ref) || vegaUtil.error('Operator not defined: ' + _.$ref);\n  }\n  /**\n   * Resolve an expression reference.\n   */\n\n\n  function getExpression(_, ctx, params) {\n    if (_.$params) {\n      // parse expression parameters\n      ctx.parseParameters(_.$params, params);\n    }\n\n    const k = 'e:' + _.$expr.code + '_' + _.$name;\n    return ctx.fn[k] || (ctx.fn[k] = vegaUtil.accessor(ctx.parameterExpression(_.$expr), _.$fields, _.$name));\n  }\n  /**\n   * Resolve a key accessor reference.\n   */\n\n\n  function getKey(_, ctx) {\n    const k = 'k:' + _.$key + '_' + !!_.$flat;\n    return ctx.fn[k] || (ctx.fn[k] = vegaUtil.key(_.$key, _.$flat, ctx.expr.codegen));\n  }\n  /**\n   * Resolve a field accessor reference.\n   */\n\n\n  function getField(_, ctx) {\n    if (!_.$field) return null;\n    const k = 'f:' + _.$field + '_' + _.$name;\n    return ctx.fn[k] || (ctx.fn[k] = vegaUtil.field(_.$field, _.$name, ctx.expr.codegen));\n  }\n  /**\n   * Resolve a comparator function reference.\n   */\n\n\n  function getCompare(_, ctx) {\n    // As of Vega 5.5.3, $tupleid sort is no longer used.\n    // Keep here for now for backwards compatibility.\n    const k = 'c:' + _.$compare + '_' + _.$order,\n          c = vegaUtil.array(_.$compare).map(_ => _ && _.$tupleid ? vegaDataflow.tupleid : _);\n    return ctx.fn[k] || (ctx.fn[k] = vegaUtil.compare(c, _.$order, ctx.expr.codegen));\n  }\n  /**\n   * Resolve an encode operator reference.\n   */\n\n\n  function getEncode(_, ctx) {\n    const spec = _.$encode,\n          encode = {};\n\n    for (const name in spec) {\n      const enc = spec[name];\n      encode[name] = vegaUtil.accessor(ctx.encodeExpression(enc.$expr), enc.$fields);\n      encode[name].output = enc.$output;\n    }\n\n    return encode;\n  }\n  /**\n   * Resolve a context reference.\n   */\n\n\n  function getContext(_, ctx) {\n    return ctx;\n  }\n  /**\n   * Resolve a recursive subflow specification.\n   */\n\n\n  function getSubflow(_, ctx) {\n    const spec = _.$subflow;\n    return function (dataflow, key, parent) {\n      const subctx = ctx.fork().parse(spec),\n            op = subctx.get(spec.operators[0].id),\n            p = subctx.signals.parent;\n      if (p) p.set(parent);\n\n      op.detachSubflow = () => ctx.detach(subctx);\n\n      return op;\n    };\n  }\n  /**\n   * Resolve a tuple id reference.\n   */\n\n\n  function getTupleId() {\n    return vegaDataflow.tupleid;\n  }\n\n  /**\n   * Parse an event stream specification.\n   */\n\n  function parseStream (spec) {\n    var ctx = this,\n        filter = spec.filter != null ? ctx.eventExpression(spec.filter) : undefined,\n        stream = spec.stream != null ? ctx.get(spec.stream) : undefined,\n        args;\n\n    if (spec.source) {\n      stream = ctx.events(spec.source, spec.type, filter);\n    } else if (spec.merge) {\n      args = spec.merge.map(_ => ctx.get(_));\n      stream = args[0].merge.apply(args[0], args.slice(1));\n    }\n\n    if (spec.between) {\n      args = spec.between.map(_ => ctx.get(_));\n      stream = stream.between(args[0], args[1]);\n    }\n\n    if (spec.filter) {\n      stream = stream.filter(filter);\n    }\n\n    if (spec.throttle != null) {\n      stream = stream.throttle(+spec.throttle);\n    }\n\n    if (spec.debounce != null) {\n      stream = stream.debounce(+spec.debounce);\n    }\n\n    if (stream == null) {\n      vegaUtil.error('Invalid stream definition: ' + JSON.stringify(spec));\n    }\n\n    if (spec.consume) stream.consume(true);\n    ctx.stream(spec, stream);\n  }\n\n  /**\n   * Parse an event-driven operator update.\n   */\n\n  function parseUpdate (spec) {\n    var ctx = this,\n        srcid = vegaUtil.isObject(srcid = spec.source) ? srcid.$ref : srcid,\n        source = ctx.get(srcid),\n        target = null,\n        update = spec.update,\n        params = undefined;\n    if (!source) vegaUtil.error('Source not defined: ' + spec.source);\n    target = spec.target && spec.target.$expr ? ctx.eventExpression(spec.target.$expr) : ctx.get(spec.target);\n\n    if (update && update.$expr) {\n      if (update.$params) {\n        params = ctx.parseParameters(update.$params);\n      }\n\n      update = ctx.handlerExpression(update.$expr);\n    }\n\n    ctx.update(spec, source, target, update, params);\n  }\n\n  const SKIP = {\n    skip: true\n  };\n  function getState(options) {\n    var ctx = this,\n        state = {};\n\n    if (options.signals) {\n      var signals = state.signals = {};\n      Object.keys(ctx.signals).forEach(key => {\n        const op = ctx.signals[key];\n\n        if (options.signals(key, op)) {\n          signals[key] = op.value;\n        }\n      });\n    }\n\n    if (options.data) {\n      var data = state.data = {};\n      Object.keys(ctx.data).forEach(key => {\n        const dataset = ctx.data[key];\n\n        if (options.data(key, dataset)) {\n          data[key] = dataset.input.value;\n        }\n      });\n    }\n\n    if (ctx.subcontext && options.recurse !== false) {\n      state.subcontext = ctx.subcontext.map(ctx => ctx.getState(options));\n    }\n\n    return state;\n  }\n  function setState(state) {\n    var ctx = this,\n        df = ctx.dataflow,\n        data = state.data,\n        signals = state.signals;\n    Object.keys(signals || {}).forEach(key => {\n      df.update(ctx.signals[key], signals[key], SKIP);\n    });\n    Object.keys(data || {}).forEach(key => {\n      df.pulse(ctx.data[key].input, df.changeset().remove(vegaUtil.truthy).insert(data[key]));\n    });\n    (state.subcontext || []).forEach((substate, i) => {\n      const subctx = ctx.subcontext[i];\n      if (subctx) subctx.setState(substate);\n    });\n  }\n\n  /**\n   * Context objects store the current parse state.\n   * Enables lookup of parsed operators, event streams, accessors, etc.\n   * Provides a 'fork' method for creating child contexts for subflows.\n   */\n\n  function context (df, transforms, functions, expr) {\n    return new Context(df, transforms, functions, expr);\n  }\n\n  function Context(df, transforms, functions, expr) {\n    this.dataflow = df;\n    this.transforms = transforms;\n    this.events = df.events.bind(df);\n    this.expr = expr || expressionCodegen, this.signals = {};\n    this.scales = {};\n    this.nodes = {};\n    this.data = {};\n    this.fn = {};\n\n    if (functions) {\n      this.functions = Object.create(functions);\n      this.functions.context = this;\n    }\n  }\n\n  function Subcontext(ctx) {\n    this.dataflow = ctx.dataflow;\n    this.transforms = ctx.transforms;\n    this.events = ctx.events;\n    this.expr = ctx.expr;\n    this.signals = Object.create(ctx.signals);\n    this.scales = Object.create(ctx.scales);\n    this.nodes = Object.create(ctx.nodes);\n    this.data = Object.create(ctx.data);\n    this.fn = Object.create(ctx.fn);\n\n    if (ctx.functions) {\n      this.functions = Object.create(ctx.functions);\n      this.functions.context = this;\n    }\n  }\n\n  Context.prototype = Subcontext.prototype = {\n    fork() {\n      const ctx = new Subcontext(this);\n      (this.subcontext || (this.subcontext = [])).push(ctx);\n      return ctx;\n    },\n\n    detach(ctx) {\n      this.subcontext = this.subcontext.filter(c => c !== ctx); // disconnect all nodes in the subcontext\n      // wipe out targets first for better efficiency\n\n      const keys = Object.keys(ctx.nodes);\n\n      for (const key of keys) ctx.nodes[key]._targets = null;\n\n      for (const key of keys) ctx.nodes[key].detach();\n\n      ctx.nodes = null;\n    },\n\n    get(id) {\n      return this.nodes[id];\n    },\n\n    set(id, node) {\n      return this.nodes[id] = node;\n    },\n\n    add(spec, op) {\n      const ctx = this,\n            df = ctx.dataflow,\n            data = spec.value;\n      ctx.set(spec.id, op);\n\n      if (isCollect(spec.type) && data) {\n        if (data.$ingest) {\n          df.ingest(op, data.$ingest, data.$format);\n        } else if (data.$request) {\n          df.preload(op, data.$request, data.$format);\n        } else {\n          df.pulse(op, df.changeset().insert(data));\n        }\n      }\n\n      if (spec.root) {\n        ctx.root = op;\n      }\n\n      if (spec.parent) {\n        let p = ctx.get(spec.parent.$ref);\n\n        if (p) {\n          df.connect(p, [op]);\n          op.targets().add(p);\n        } else {\n          (ctx.unresolved = ctx.unresolved || []).push(() => {\n            p = ctx.get(spec.parent.$ref);\n            df.connect(p, [op]);\n            op.targets().add(p);\n          });\n        }\n      }\n\n      if (spec.signal) {\n        ctx.signals[spec.signal] = op;\n      }\n\n      if (spec.scale) {\n        ctx.scales[spec.scale] = op;\n      }\n\n      if (spec.data) {\n        for (const name in spec.data) {\n          const data = ctx.data[name] || (ctx.data[name] = {});\n          spec.data[name].forEach(role => data[role] = op);\n        }\n      }\n    },\n\n    resolve() {\n      (this.unresolved || []).forEach(fn => fn());\n      delete this.unresolved;\n      return this;\n    },\n\n    operator(spec, update) {\n      this.add(spec, this.dataflow.add(spec.value, update));\n    },\n\n    transform(spec, type) {\n      this.add(spec, this.dataflow.add(this.transforms[canonicalType(type)]));\n    },\n\n    stream(spec, stream) {\n      this.set(spec.id, stream);\n    },\n\n    update(spec, stream, target, update, params) {\n      this.dataflow.on(stream, target, update, params, spec.options);\n    },\n\n    // expression parsing\n    operatorExpression(expr) {\n      return this.expr.operator(this, expr);\n    },\n\n    parameterExpression(expr) {\n      return this.expr.parameter(this, expr);\n    },\n\n    eventExpression(expr) {\n      return this.expr.event(this, expr);\n    },\n\n    handlerExpression(expr) {\n      return this.expr.handler(this, expr);\n    },\n\n    encodeExpression(encode) {\n      return this.expr.encode(this, encode);\n    },\n\n    // parse methods\n    parse,\n    parseOperator,\n    parseOperatorParameters,\n    parseParameters,\n    parseStream,\n    parseUpdate,\n    // state methods\n    getState,\n    setState\n  };\n\n  exports.context = context;\n\n  Object.defineProperty(exports, '__esModule', { value: true });\n\n})));\n\n};"],
"names":["shadow$provide","global","require","module","exports","factory","define","amd","globalThis","self","vega","vegaUtil","vegaDataflow","expression","ctx","args","code","length","fn","Function","concat","functions","bind","parseParameter","spec","params","isObject","i","n","PARSERS","p","hasOwnProperty","key","parse","Context","df","transforms","expr","dataflow","events","expressionCodegen","signals","scales","nodes","data","Object","create","context","Subcontext","Skip","toSet","Swap","operator","parameter","event","handler","encode","marktype","channels","name","o","stringValue","x2","x","xc","y2","y","yc","codegen","get","path","ref","map","join","comparator","fields","orders","t","f","u","v","lt","getOperator","_","$ref","error","getKey","k","$key","$flat","getExpression","$params","parseParameters","$expr","$name","accessor","parameterExpression","$fields","getField","$field","field","getEncode","$encode","enc","encodeExpression","output","$output","getCompare","$compare","$order","c","array","$tupleid","tupleid","compare","getContext","getSubflow","$subflow","parent","subctx","fork","op","operators","id","set","detachSubflow","op.detachSubflow","detach","getTupleId","SKIP","skip","prototype","push","subcontext","filter","keys","_targets","node","add","value","toLowerCase","type","$ingest","ingest","$format","$request","preload","pulse","changeset","insert","root","connect","targets","unresolved","signal","scale","forEach","role","resolve","update","transform","stream","target","on","options","operatorExpression","eventExpression","handlerExpression","background","eventConfig","locale","entry","parseOperator","parseOperatorParameters","streams","parseStream","updates","parseUpdate","parameters","react","initonly","isArray","undefined","source","merge","apply","slice","between","throttle","debounce","JSON","stringify","consume","srcid","getState","state","dataset","input","recurse","setState","remove","truthy","substate","defineProperty"]
}
